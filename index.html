<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Resume Screener</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&family=Rajdhani:wght@700&family=Exo+2:wght@900&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="screener.css" />
  <script src="galaxy.js" defer></script>
</head>

<body data-galaxy data-stars="250" data-speed="0.4" data-color-scheme="purple">
  <div style="
position:fixed;
bottom:10px;
right:10px;
background:#111;
color:#fff;
padding:8px 14px;
border-radius:6px;
font-size:12px;
opacity:0.8;
z-index:9999;">
Live backend available during demo sessions
</div>
  <!-- Top Left Brand -->
  <div class="site-brand">
    <span class="brand-text">ARS</span>
  </div>

  <div class="overlay">
    <div class="bg-circle circle-1"></div>
    <div class="bg-circle circle-2"></div>
    <div class="bg-circle circle-3"></div>
    <div class="bg-circle circle-4"></div>
  </div>

  <div class="container">
    <h1>AI Resume Screener</h1>
    <p>Upload your resume and let AI match you with the best job opportunities.</p>

    <form id="resumeForm" enctype="multipart/form-data">
      <div class="input-group">
        <input type="text" name="name" placeholder="Full Name" required />
      </div>

      <div class="input-group">
        <input type="email" name="email" placeholder="Email Address" required />
      </div>

<div class="input-group">
  <select name="role" required>
    <option value="">-- Select Job Role --</option>

    <option value="Software Engineer">Software Engineer</option>
    <option value="Frontend Developer">Frontend Developer</option>
    <option value="Backend Developer">Backend Developer</option>
    <option value="Full Stack Developer">Full Stack Developer</option>

    <option value="Data Scientist">Data Scientist</option>
    <option value="Data Analyst">Data Analyst</option>

    <option value="AI Engineer">AI Engineer</option>
    <option value="Machine Learning Engineer">Machine Learning Engineer</option>
    <option value="MLOps Engineer">MLOps Engineer</option>
    <option value="Prompt Engineer">Prompt Engineer</option>
    <option value="AI Automation Engineer">AI Automation Engineer</option>

    <option value="DevOps Engineer">DevOps Engineer</option>
    <option value="Cloud Engineer">Cloud Engineer</option>
    <option value="Cybersecurity Analyst">Cybersecurity Analyst</option>

    <option value="Mobile App Developer">Mobile App Developer</option>
    <option value="UI/UX Designer">UI/UX Designer</option>

    <option value="Product Manager">Product Manager</option>
    <option value="QA Automation Engineer">QA Automation Engineer</option>

    <option value="Blockchain Developer">Blockchain Developer</option>
    <option value="AR/VR Developer">AR/VR Developer</option>

  </select>
</div>

      <div class="input-group file-upload">
        <input type="file" id="resumeFile" name="resume"
          accept=".pdf,.doc,.docx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document"
          required />
      </div>

      <button type="submit">Upload Resume</button>
    </form>

    <footer>Powered by <strong>n8n</strong> â€¢ <strong>OpenAI</strong> â€¢ <strong>Airtable</strong></footer>
  </div>

  <div id="popup" class="popup">âœ… Resume submitted successfully!</div>

  <!-- Loader Overlay -->
  <div id="loaderOverlay" class="loader-overlay">
    <div>
      <div class="loader"></div>
      <div class="loader-text">Uploading your resume...</div>
    </div>
  </div>

  <script src="config.js"></script>
  <script>
    // ---- Custom Cursor ---- 
    const cursor = document.createElement('div');
    const cursorDot = document.createElement('div');
    cursor.className = 'cursor';
    cursorDot.className = 'cursor-dot';
    document.body.appendChild(cursor);
    document.body.appendChild(cursorDot);

    let mouseX = 0, mouseY = 0;
    let cursorX = 0, cursorY = 0;
    let dotX = 0, dotY = 0;

    // Update mouse position
    document.addEventListener('mousemove', (e) => {
      mouseX = e.clientX;
      mouseY = e.clientY;
      dotX = e.clientX;
      dotY = e.clientY;

      // Create trail effect
      if (Math.random() > 0.7) {
        const trail = document.createElement('div');
        trail.className = 'cursor-trail';
        trail.style.left = e.clientX + 'px';
        trail.style.top = e.clientY + 'px';
        document.body.appendChild(trail);
        setTimeout(() => trail.remove(), 600);
      }
    });

    // Smooth cursor follow animation
    function animateCursor() {
      // Smooth follow effect
      cursorX += (mouseX - cursorX) * 0.15;
      cursorY += (mouseY - cursorY) * 0.15;

      cursor.style.left = cursorX + 'px';
      cursor.style.top = cursorY + 'px';
      cursorDot.style.left = dotX + 'px';
      cursorDot.style.top = dotY + 'px';

      requestAnimationFrame(animateCursor);
    }
    animateCursor();

    // Hover effect on interactive elements
    const hoverElements = document.querySelectorAll('button, input, a, .input-group');
    hoverElements.forEach(el => {
      el.addEventListener('mouseenter', () => cursor.classList.add('hover'));
      el.addEventListener('mouseleave', () => cursor.classList.remove('hover'));
    });

    // ---- Form Submission ----
    const form = document.getElementById("resumeForm");
    const submitBtn = form.querySelector('button[type="submit"]');
    const loaderOverlay = document.getElementById("loaderOverlay");

    // Detect if mobile
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

    form.addEventListener("submit", function (e) {
      e.preventDefault();
      const formData = new FormData(form);
      const webhookUrl = (window.APP_CONFIG && window.APP_CONFIG.webhookUrl) || "YOUR_KEY_VALUE";

      // Get the file input
      const fileInput = document.getElementById('resumeFile');
      const file = fileInput.files[0];

      // Validate file exists
      if (!file) {
        showPopup("âš ï¸ Please select a resume file to upload.", true);
        return;
      }

      // Validate file size (max 10MB for mobile compatibility)
      const maxSize = 10 * 1024 * 1024; // 10MB
      if (file.size > maxSize) {
        showPopup("âš ï¸ File is too large. Please upload a resume smaller than 10MB.", true);
        return;
      }

      // Validate file type
      const validTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
      const validExtensions = ['.pdf', '.doc', '.docx'];
      const fileExtension = file.name.substring(file.name.lastIndexOf('.')).toLowerCase();

      if (!validTypes.includes(file.type) && !validExtensions.includes(fileExtension)) {
        showPopup("âš ï¸ Please upload a PDF or Word document (.pdf, .doc, .docx)", true);
        return;
      }

      // Debug logs
      console.log("=== UPLOAD START ===");
      console.log("ðŸ“± Device:", isMobile ? "Mobile" : "Desktop");
      console.log("ðŸŒ User Agent:", navigator.userAgent);
      console.log("ðŸ”— Using webhook URL:", webhookUrl);
      console.log("ðŸ“ Environment:", window.APP_CONFIG?.env);
      console.log("ðŸŒ Hostname:", location.hostname);
      console.log("ðŸŒ Origin:", window.location.origin);
      console.log("ðŸŒ Protocol:", location.protocol);
      console.log("ðŸ“‹ All URLs:", window.APP_CONFIG?.urls);
      console.log("ðŸ“„ File:", file.name, "Type:", file.type, "Size:", (file.size / 1024).toFixed(2), "KB");
      console.log("ðŸ“„ File lastModified:", new Date(file.lastModified).toISOString());

      // Log FormData contents before sending
      console.log("ðŸ“¦ FormData contents:");
      for (let pair of formData.entries()) {
        if (pair[1] instanceof File) {
          console.log(`  - ${pair[0]}: File(name="${pair[1].name}", size=${pair[1].size}, type="${pair[1].type}")`);
        } else {
          console.log(`  - ${pair[0]}: "${pair[1]}"`);
        }
      }

      // Show loader with submission message
      showLoader();
      showPopup("ðŸ“¤ Resume submitted! Please wait while we process your application...", false, true);

      // Check network connectivity first
      if (!navigator.onLine) {
        hideLoader();
        showPopup("âš ï¸ No internet connection detected. Please check your connection and try again.", true);
        console.error("âŒ navigator.onLine is false - no internet connection");
        return;
      }

      console.log("âœ… Network online check passed");

      // Test if we can read the file (mobile-specific check)
      if (window.FileReader && file.size > 0) {
        const reader = new FileReader();
        reader.onload = function (e) {
          console.log("âœ… FileReader test passed - file is readable");
          console.log("   First 100 bytes:", e.target.result.substring(0, 100));
        };
        reader.onerror = function (e) {
          console.error("âŒ FileReader error:", e);
        };
        // Read just the first 1KB to test
        reader.readAsText(file.slice(0, 1024));
      }

      // Use XMLHttpRequest for better mobile compatibility
      const xhr = new XMLHttpRequest();

      // Timeout after 60 seconds (longer for mobile)
      xhr.timeout = 60000;

      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
          console.log("ðŸ“¡ Response received - ReadyState:", xhr.readyState, "Status:", xhr.status);
        }
      };

xhr.onload = function() {
  hideLoader();

  console.log("ðŸ“¡ Response received:", xhr.status);

  // REAL SUCCESS
  if (xhr.status >= 200 && xhr.status < 300) {
    console.log("âœ… Upload successful:", xhr.responseText);
    showPopup("âœ… Resume submitted successfully! You will be informed through mail.", false);
    form.reset();
  } 
  // DEMO MODE (503, 404, 500, etc)
  else {
    console.warn("âš¡ Backend unavailable â€” switching to demo mode");

    showPopup("âš¡ Demo Mode: Live backend unavailable. Showing sample result.", false);

    setTimeout(() => {
      showPopup("âœ… Resume processed successfully (Demo Result)", false);
      form.reset();
    }, 4000);
  }
};


      xhr.onerror = function () {
        hideLoader();

        console.warn("âš¡ Backend offline â€” demo mode activated");

        // Check if it's a CORS error (status 0) or network error
        if (xhr.status === 0 && xhr.readyState === 4) {
          console.error("âŒ Likely CORS or Network Error (status 0, readyState 4)");
          showPopup("âš ï¸ Cannot connect to server. Possible CORS or network firewall issue on mobile.", true);
        } else if (xhr.status === 0) {
          console.error("âŒ Request failed before completion (status 0)");
          showPopup("âš ï¸ Upload failed to start. Check if your mobile network allows the connection.", true);
        } else {
          showPopup("âš¡ Demo Mode: Backend offline. Showing sample AI result.", false);

          setTimeout(() => {
            showPopup("âœ… Resume processed successfully (Demo Result)", false);
            form.reset();
          }, 4000);
        }
      };

      xhr.ontimeout = function () {
        hideLoader();
        console.error("â±ï¸ Upload timeout after 60 seconds");
        showPopup("âš ï¸ Upload timeout. Your connection may be slow. Please try again.", true);
      };

      xhr.onabort = function () {
        hideLoader();
        console.error("ðŸš« Upload aborted");
        showPopup("âš ï¸ Upload was cancelled. Please try again.", true);
      };

      // Progress tracking
      xhr.upload.onprogress = function (e) {
        if (e.lengthComputable) {
          const percentComplete = (e.loaded / e.total) * 100;
          console.log("ðŸ“Š Upload progress:", percentComplete.toFixed(2) + "%");
        }
      };

      xhr.upload.onerror = function (e) {
        console.error("âŒ Upload error event:", e);
        hideLoader();
        showPopup("âš ï¸ Upload failed. Please try again.", true);
      };

      try {
        xhr.open("POST", webhookUrl, true);

        // Don't set withCredentials for CORS unless needed
        // xhr.withCredentials = false;

        // Let browser set Content-Type with boundary for multipart/form-data
        // Don't set it manually for FormData

        console.log("ðŸš€ Sending XHR request to:", webhookUrl);
        console.log("ðŸ“¦ FormData entries:");
        for (let pair of formData.entries()) {
          if (pair[1] instanceof File) {
            console.log("  -", pair[0], ":", pair[1].name, "(", pair[1].size, "bytes )");
          } else {
            console.log("  -", pair[0], ":", pair[1]);
          }
        }

        xhr.send(formData);
        console.log("âœ… XHR send() called successfully");

      } catch (error) {
        console.error("âŒ Exception during XHR send:", error);
        hideLoader();
        showPopup("âš ï¸ Failed to send request. Please try again.", true);
      }
    });

    function showLoader() {
      submitBtn.classList.add('loading');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Uploading...';
      loaderOverlay.classList.add('active');
    }

    function hideLoader() {
      submitBtn.classList.remove('loading');
      submitBtn.disabled = false;
      submitBtn.textContent = 'Upload Resume';
      loaderOverlay.classList.remove('active');
    }

    function showPopup(message, isError = false, isProcessing = false) {
      const popup = document.getElementById("popup");
      popup.textContent = message;
      popup.classList.toggle('error', isError);
      popup.classList.toggle('processing', isProcessing);
      popup.classList.add("show");
      setTimeout(() => popup.classList.remove("show"), isProcessing ? 60000 : 5000); // Keep processing message visible longer
    }
  </script>
</body>

</html>